# Argo Rollouts deployment automation
# Deploys Argo Rollouts controller to the 'cicd' namespace

NAMESPACE := "cicd"
RELEASE_NAME := "argo-rollouts"

install:
    helm repo add argo https://argoproj.github.io/argo-helm || true
    helm repo update
    kubectl create namespace {{NAMESPACE}} || true
    helm install {{RELEASE_NAME}} argo/argo-rollouts --namespace {{NAMESPACE}} --values values.yaml
    @echo ""
    @echo "Argo Rollouts deployed successfully!"
    @echo "Controller installed in {{NAMESPACE}} namespace"
    @echo ""

upgrade:
    helm upgrade {{RELEASE_NAME}} argo/argo-rollouts --namespace {{NAMESPACE}} --values values.yaml

uninstall:
    helm uninstall {{RELEASE_NAME}} --namespace {{NAMESPACE}} || true

status:
    kubectl get pods -n {{NAMESPACE}} -l app.kubernetes.io/name=argo-rollouts
    kubectl get crd | grep rollout

logs:
    kubectl logs -n {{NAMESPACE}} -l app.kubernetes.io/name=argo-rollouts --tail=100 -f
