# Grafana Dashboard for Prometheus Pusher Test Metrics

This document describes the Grafana dashboard for visualizing metrics generated by prometheus-pusher.

## Dashboard Overview

The dashboard displays all test metrics with the `prometheus_pusher_test_` prefix, making it clear they are generated by the prometheus-pusher testing/demo functionality.

## Metrics Displayed

### 1. Request Rate
- **Type**: Line graph
- **Metric**: `rate(prometheus_pusher_test_requests_total[5m])`
- **Description**: Shows the rate of requests per second over the last 5 minutes
- **Use**: Monitor request throughput

### 2. Total Requests
- **Type**: Stat panel
- **Metric**: `prometheus_pusher_test_requests_total`
- **Description**: Counter showing total number of requests processed
- **Display**: Large number with area graph background

### 3. Active Connections
- **Type**: Gauge
- **Metric**: `prometheus_pusher_test_active_connections`
- **Description**: Current number of active connections (0-100)
- **Thresholds**:
  - Green: 0-50
  - Yellow: 50-80
  - Red: 80-100

### 4. Temperature
- **Type**: Gauge
- **Metric**: `prometheus_pusher_test_temperature_celsius`
- **Description**: Current temperature in Celsius (0-50°C)
- **Thresholds**:
  - Blue: 0-20°C
  - Green: 20-30°C
  - Yellow: 30-35°C
  - Red: 35-50°C

### 5. Request Duration Histogram
- **Type**: Line graph
- **Metrics**:
  - `histogram_quantile(0.50, rate(prometheus_pusher_test_request_duration_seconds_bucket[5m]))` - p50
  - `histogram_quantile(0.90, rate(prometheus_pusher_test_request_duration_seconds_bucket[5m]))` - p90
  - `histogram_quantile(0.99, rate(prometheus_pusher_test_request_duration_seconds_bucket[5m]))` - p99
- **Description**: Shows request duration percentiles over time
- **Use**: Identify latency trends and outliers

### 6. Average Request Duration
- **Type**: Stat panel
- **Metric**: `rate(prometheus_pusher_test_request_duration_seconds_sum[5m]) / rate(prometheus_pusher_test_request_duration_seconds_count[5m])`
- **Description**: Average request duration in seconds
- **Display**: Number with area graph, 3 decimal places

### 7. Jobs Processed by Type
- **Type**: Bar gauge
- **Metric**: `sum by (job_type) (prometheus_pusher_test_jobs_processed_total)`
- **Description**: Total jobs processed grouped by job type (email, report, backup)
- **Display**: Horizontal gradient bars

### 8. Jobs Status Breakdown
- **Type**: Table
- **Metric**: `prometheus_pusher_test_jobs_processed_total`
- **Description**: Detailed breakdown showing job type, status, and count
- **Columns**: Job Type, Status, Count

## Deployment

### Prerequisites
- Grafana instance running and accessible
- Prometheus as a data source in Grafana
- Metrics being pushed to Prometheus via prometheus-pusher

### Deploy via Script
```bash
# Port-forward to Grafana (if running in Kubernetes)
kubectl port-forward -n monitoring svc/prometheus-grafana 3000:80

# Deploy dashboard (in another terminal)
./deploy-dashboard.sh
```

### Deploy Manually
1. Open Grafana UI
2. Go to Dashboards → Import
3. Upload `grafana-dashboard.json`
4. Select Prometheus data source
5. Click Import

### Custom Deployment
```bash
# With custom Grafana URL and credentials
GRAFANA_URL="http://grafana.example.com" \
GRAFANA_USER="admin" \
GRAFANA_PASSWORD="secret" \
./deploy-dashboard.sh
```

## Dashboard Features

- **Auto-refresh**: Updates every 10 seconds
- **Time range**: Last 15 minutes by default
- **Refresh intervals**: 5s, 10s, 30s, 1m, 5m
- **Shared tooltips**: Hover over graphs to see all series values
- **Dark theme**: Optimized for dark mode viewing

## Metric Naming Convention

All metrics use the `prometheus_pusher_test_` prefix to:
- Clearly identify them as test/demo metrics
- Distinguish from production application metrics
- Make cleanup and filtering easier
- Prevent confusion with real application data

## Testing the Dashboard

1. **Push test metrics**:
   ```bash
   ./prometheus-pusher -mode realtime -pushgateway http://localhost:9091
   ```

2. **Continuous updates** (for live dashboard testing):
   ```bash
   ./prometheus-pusher -mode realtime -pushgateway http://localhost:9091 -continuous
   ```

3. **View in Grafana**:
   - Navigate to the "Prometheus Pusher Test Metrics" dashboard
   - Watch metrics update in real-time
   - Interact with time ranges and refresh intervals

## Cleanup

To remove old test metrics from Pushgateway:
```bash
# Delete all metrics for the example_metrics_pusher job
curl -X DELETE http://localhost:9091/metrics/job/example_metrics_pusher
```

## Customization

The dashboard JSON file can be customized:
- Adjust panel sizes via `gridPos`
- Change colors and thresholds
- Add new panels for additional metrics
- Modify queries and aggregations
- Update refresh intervals

After making changes, redeploy using the deployment script.
